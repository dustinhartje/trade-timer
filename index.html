<!DOCTYPE html>
 <html lang="en">
 <head>
     <meta charset="UTF-8">
     <meta name="viewport" content="width=device-width, initial-scale=1.0">
     <title>Trade Timer</title>
     <style>
         body { font-family: sans-serif; }
         .input-group { margin-bottom: 10px; }
         .strategy { border: 1px solid #ccc; padding: 10px; margin-bottom: 10px; }
         .hours { display: grid; grid-template-columns: repeat(auto-fit, minmax(60px, 1fr)); gap: 5px; margin-top: 5px; }
         .hour-toggle { width: 100%; padding: 5px; box-sizing: border-box; text-align: center; cursor: pointer; }
         .hour-valid { background-color: #e0ffe0; }
         .hour-invalid { background-color: #ffe0e0; }
         #ema-data { margin-top: 20px; border: 1px solid #ccc; padding: 10px; }
     </style>
 </head>
 <body>
     <h1>Trade Timer</h1>
 
     <div class="input-group">
         <label for="last-hour-ema">Last Hour EMA:</label>
         <input type="number" id="last-hour-ema" placeholder="Enter EMA">
     </div>
 
     <div class="input-group">
         <label for="open-price">Open Price:</label>
         <input type="number" id="open-price" placeholder="Enter Open Price">
     </div>
 
     <div id="strategies-container">
         </div>
 
     <div id="ema-data">
         <h2>EMA Data (Simulated - Real-time fetching not possible client-side)</h2>
         <p>20-Period Hourly EMA: <span id="ema-20">--</span></p>
         <p>9-Period Hourly EMA: <span id="ema-9">--</span></p>
         <p><em>Note: Real-time data fetching from TradingView directly in this static page is not feasible due to CORS restrictions and lack of a public API.</em></p>
     </div>
 
     <p><a href="hourly_values.html">View All Hourly Values</a></p>
 
     <script>
         const strategiesData = [
             { name: "IRA Bounce", type: "long", offset: 3 },
             { name: "IRA Reject", type: "short", offset: 5 },
             { name: "Apex Bounce", type: "long", offset: 2 },
             { name: "Apex Reject", type: "short", offset: 4 }
         ];
 
         // Easily modifiable hour validity for each weekday (9:00 to 15:00)
         const strategyHours = {
             "IRA Bounce": {
                 "Monday": ["9:00", "10:00", "11:00", "12:00", "13:00", "14:00", "15:00"],
                 "Tuesday": ["9:00", "10:00", "11:00", "12:00", "13:00", "14:00", "15:00"],
                 "Wednesday": ["9:00", "10:00", "11:00", "12:00", "13:00", "14:00", "15:00"],
                 "Thursday": ["9:00", "10:00", "11:00", "12:00", "13:00", "14:00", "15:00"],
                 "Friday": ["9:00", "10:00", "11:00", "12:00", "13:00", "14:00", "15:00"]
             },
             "IRA Reject": {
                 "Monday": ["9:00", "10:00", "11:00", "12:00", "13:00", "14:00", "15:00"],
                 "Tuesday": ["9:00", "10:00", "11:00", "12:00", "13:00", "14:00", "15:00"],
                 "Wednesday": ["9:00", "10:00", "11:00", "12:00", "13:00", "14:00", "15:00"],
                 "Thursday": ["9:00", "10:00", "11:00", "12:00", "13:00", "14:00", "15:00"],
                 "Friday": ["9:00", "10:00", "11:00", "12:00", "13:00", "14:00", "15:00"]
             },
             "Apex Bounce": {
                 "Monday": ["9:00", "10:00", "11:00", "12:00", "13:00", "14:00", "15:00"],
                 "Tuesday": ["9:00", "10:00", "11:00", "12:00", "13:00", "14:00", "15:00"],
                 "Wednesday": ["9:00", "10:00", "11:00", "12:00", "13:00", "14:00", "15:00"],
                 "Thursday": ["9:00", "10:00", "11:00", "12:00", "13:00", "14:00", "15:00"],
                 "Friday": ["9:00", "10:00", "11:00", "12:00", "13:00", "14:00", "15:00"]
             },
             "Apex Reject": {
                 "Monday": ["9:00", "10:00", "11:00", "12:00", "13:00", "14:00", "15:00"],
                 "Tuesday": ["9:00", "10:00", "11:00", "12:00", "13:00", "14:00", "15:00"],
                 "Wednesday": ["9:00", "10:00", "11:00", "12:00", "13:00", "14:00", "15:00"],
                 "Thursday": ["9:00", "10:00", "11:00", "12:00", "13:00", "14:00", "15:00"],
                 "Friday": ["9:00", "10:00", "11:00", "12:00", "13:00", "14:00", "15:00"]
             }
         };
 
         function roundToNearestQuarter(value) {
             return Math.round(value * 4) / 4;
         }
 
         function calculateTargetPrice(ema, offset, type) {
             const roundedEma = type === "long" ? Math.ceil(ema * 4) / 4 : Math.floor(ema * 4) / 4;
             const adjustment = offset / 4;
             return type === "long" ? roundedEma - adjustment : roundedEma + adjustment;
         }
 
         function updateTargetPrices() {
             const lastHourEmaInput = document.getElementById("last-hour-ema");
             const emaValue = parseFloat(lastHourEmaInput.value);
             const strategiesContainer = document.getElementById("strategies-container");
             strategiesContainer.innerHTML = ""; // Clear previous strategy displays
 
             if (!isNaN(emaValue)) {
                 strategiesData.forEach(strategy => {
                     const targetPrice = calculateTargetPrice(emaValue, strategy.offset, strategy.type);
                     const strategyDiv = document.createElement("div");
                     strategyDiv.classList.add("strategy");
                     strategyDiv.innerHTML = `<h3>${strategy.name} (${strategy.type})</h3>
                                                <p>Offset: ${strategy.offset}</p>
                                                <p>Target Entry Price: ${targetPrice.toFixed(2)}</p>
                                                <h4>Valid Trading Hours</h4>
                                                <div class="hours" id="${strategy.name.toLowerCase().replace(/ /g, '-')}-hours"></div>`;
                     strategiesContainer.appendChild(strategyDiv);
                     renderHourToggles(strategy);
                 });
             }
         }
 
         function renderHourToggles(strategy) {
             const hoursContainerId = `${strategy.name.toLowerCase().replace(/ /g, '-')}-hours`;
             const hoursContainer = document.getElementById(hoursContainerId);
             const weekday = new Date().toLocaleDateString('en-US', { weekday: 'long' });
             const validHours = strategyHours?.[strategy.name]?.[weekday] || [];
 
             for (let hour = 9; hour <= 15; hour++) {
                 for (let minute = 0; minute <= 0; minute += 0) { // Just the top of the hour
                     const time = `${hour}:${minute < 10 ? '0' : ''}${minute}`;
                     const toggle = document.createElement("div");
                     toggle.classList.add("hour-toggle");
                     toggle.textContent = time;
                     const isValid = validHours.includes(time);
                     toggle.classList.add(isValid ? "hour-valid" : "hour-invalid");
                     toggle.dataset.strategy = strategy.name;
                     toggle.dataset.hour = time;
                     toggle.dataset.valid = isValid;
                     toggle.addEventListener("click", toggleHour);
                     hoursContainer.appendChild(toggle);
                 }
             }
         }
 
         function toggleHour(event) {
             const toggleDiv = event.target;
             const strategyName = toggleDiv.dataset.strategy;
             const hour = toggleDiv.dataset.hour;
             const weekday = new Date().toLocaleDateString('en-US', { weekday: 'long' });
 
             if (strategyHours?.[strategyName]?.[weekday]?.includes(hour)) {
                 strategyHours?.[strategyName]?.[weekday] = strategyHours?.[strategyName]?.[weekday].filter(h => h !== hour);
                 toggleDiv.classList.remove("hour-valid");
                 toggleDiv.classList.add("hour-invalid");
                 toggleDiv.dataset.valid = false;
             } else {
                 if (!strategyHours?.[strategyName]?.[weekday]) {
                     strategyHours?.[strategyName]?.[weekday] = [];
                 }
                 strategyHours?.[strategyName]?.[weekday].push(hour);
                 strategyHours?.[strategyName]?.[weekday].sort(); // Keep hours sorted
                 toggleDiv.classList.remove("hour-invalid");
                 toggleDiv.classList.add("hour-valid");
                 toggleDiv.dataset.valid = true;
             }
             // Optionally, you could trigger an update of some visual indication if needed
         }
 
         document.getElementById("last-hour-ema").addEventListener("input", updateTargetPrices);
         document.getElementById("open-price").addEventListener("input", updateTargetPrices);
 
         function clearInputsAtTopOfHour() {
             const now = new Date();
             if (now.getMinutes() === 0 && now.getSeconds() === 0) {
                 document.getElementById("last-hour-ema").value = "";
                 document.getElementById("open-price").value = "";
             }
         }
 
         // Check every second if it's the top of the hour
         setInterval(clearInputsAtTopOfHour, 1000);
 
         // Initial rendering of strategy sections
         strategiesData.forEach(renderHourToggles);
         updateTargetPrices(); // Render initial target prices if EMA is already entered (for testing)
 
         // --- SIMULATED EMA UPDATES (WILL NOT FETCH REAL TRADINGVIEW DATA) ---
         function updateSimulatedEMA() {
             const ema20Element = document.getElementById("ema-20");
             const ema9Element = document.getElementById("ema-9");
             const simulatedEMA20 = Math.random() * 50 + 200; // Example random values
             const simulatedEMA9 = Math.random() * 30 + 210;
             ema20Element.textContent = simulatedEMA20.toFixed(2);
             ema9Element.textContent = simulatedEMA9.toFixed(2);
         }
 
         // Simulate EMA updates every 5 seconds
         setInterval(updateSimulatedEMA, 5000);
         updateSimulatedEMA(); // Initial call
 
     </script>
 </body>
 </html>
